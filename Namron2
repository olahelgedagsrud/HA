blueprint:
  name: Namron K4 – 2 channel Zigbee2MQTT (event based)
  description: Handle all button events from Namron K4 2-channel switch via Zigbee2MQTT.
  domain: automation

  input:
    zigbee_device:
      name: Zigbee2MQTT Device
      description: Select the Namron K4 switch
      selector:
        device:
          filter:
            - integration: mqtt
          multiple: false

    # Channel 1 actions
    ch1_on:
      name: Channel 1 – ON
      selector: 
        action: {}
      default: []

    ch1_off:
      name: Channel 1 – OFF
      selector: 
        action: {}
      default: []

    ch1_bright_up:
      name: Channel 1 – Brightness up (hold)
      selector: 
        action: {}
      default: []

    ch1_bright_down:
      name: Channel 1 – Brightness down (hold)
      selector: 
        action: {}
      default: []

    ch1_bright_stop:
      name: Channel 1 – Brightness stop (release)
      selector: 
        action: {}
      default: []

    # Channel 2 actions
    ch2_on:
      name: Channel 2 – ON
      selector: 
        action: {}
      default: []

    ch2_off:
      name: Channel 2 – OFF
      selector: 
        action: {}
      default: []

    ch2_bright_up:
      name: Channel 2 – Brightness up (hold)
      selector: 
        action: {}
      default: []

    ch2_bright_down:
      name: Channel 2 – Brightness down (hold)
      selector: 
        action: {}
      default: []

    ch2_bright_stop:
      name: Channel 2 – Brightness stop (release)
      selector: 
        action: {}
      default: []


trigger_variables:
  dev: !input zigbee_device

trigger:
  - platform: event
    event_type: mqtt
    event_data:
      topic: "zigbee2mqtt/{{ device_entities(dev)[0].split('.')[1] }}/action"

condition: []

action:
  - choose:

      # ---------- CHANNEL 1 ----------
      - conditions: "{{ trigger.event.data.payload == 'on_l1' }}"
        sequence: !input ch1_on

      - conditions: "{{ trigger.event.data.payload == 'off_l1' }}"
        sequence: !input ch1_off

      - conditions: "{{ trigger.event.data.payload == 'brightness_move_up_l1' }}"
        sequence: !input ch1_bright_up

      - conditions: "{{ trigger.event.data.payload == 'brightness_move_down_l1' }}"
        sequence: !input ch1_bright_down

      - conditions: "{{ trigger.event.data.payload == 'brightness_stop_l1' }}"
        sequence: !input ch1_bright_stop


      # ---------- CHANNEL 2 ----------
      - conditions: "{{ trigger.event.data.payload == 'on_l2' }}"
        sequence: !input ch2_on

      - conditions: "{{ trigger.event.data.payload == 'off_l2' }}"
        sequence: !input ch2_off

      - conditions: "{{ trigger.event.data.payload == 'brightness_move_up_l2' }}"
        sequence: !input ch2_bright_up

      - conditions: "{{ trigger.event.data.payload == 'brightness_move_down_l2' }}"
        sequence: !input ch2_bright_down

      - conditions: "{{ trigger.event.data.payload == 'brightness_stop_l2' }}"
        sequence: !input ch2_bright_stop
